# 缓存

------

## 一、缓存的基本概念

### 1. 什么是缓存？

- 缓存是一种**数据存储结构**，用于**减少数据访问成本**。
- 通过将部分数据存储在**更接近处理器**的位置，加快访问速度。
- 类比：浏览器缓存网页图片、咖啡店将常用咖啡放在收银台旁。

### 2. 为什么需要缓存？

- 不同存储介质在**速度、容量、成本**之间存在权衡：
  - CPU 缓存/寄存器：极快，容量极小
  - RAM：较快，容量较大
  - 硬盘：容量大，速度慢
  - 网络存储：容量无限，速度最慢
- 缓存是**在快速存储中保留部分数据**，避免频繁访问慢速存储。

---

## 二、缓存的工作原理

### 1. 缓存命中与未命中
- **Cache Hit**：数据在缓存中，直接访问，速度快。
- **Cache Miss**：数据不在缓存中，需从慢速存储中获取，速度慢。

### 2. 缓存替换策略
- 缓存空间有限，当缓存满时，需**淘汰部分数据**。
- 常见策略包括：
  - LRU（最近最少使用）
  - MRU（最近最多使用）
  - LFU（最不经常使用）
  - 预测性淘汰

---

## 三、LRU 缓存详解

### 1. 基本思想
- 淘汰**最久未被访问**的数据。
- 假设：最近被访问的数据，将来也更可能被访问。

### 2. 实现方式
- 使用两种基础数据结构：
  - **哈希表**：支持 O(1) 时间查找
  - **队列（双向链表）**：记录访问顺序

#### 结构组成：
- `CacheEntry`：包含 key、value、指向队列节点的指针
- 队列节点：双向链表，支持从中间删除

#### 操作流程（CacheLookup）：
1. 查找 key 是否在哈希表中
2. 若存在（命中）：
   - 将其移到队列尾部（标记为最新使用）
3. 若不存在（未命中）：
   - 从慢速存储获取数据
   - 若缓存已满，淘汰队列头部节点（LRU）
   - 将新数据插入队列尾部并更新哈希表

---

## 四、其他缓存淘汰策略

### 1. MRU（最近最多使用）
- 淘汰**最近被访问**的数据。
- 适用场景：重复访问概率低，如电子书阅读器。

### 2. LFU（最不经常使用）
- 淘汰**访问频率最低**的数据。
- 适用场景：访问模式稳定，如家中常备咖啡种类。

### 3. 预测性淘汰
- 使用模型预测未来访问模式。
- 优点：若模型准确，命中率高
- 缺点：实现复杂，依赖模型准确性

---

## 五、缓存设计的关键问题

### 1. 缓存大小
- 太小：命中率低，效果有限
- 太大：占用宝贵内存资源，可能影响其他操作

### 2. 淘汰策略选择
- 需根据**数据访问模式**选择：
  - LRU：适合短期集中访问
  - LFU：适合稳定访问模式
  - MRU：适合顺序访问或一次性访问

---

## 六、缓存的实际意义

### 1. 性能提升
- 减少对慢速存储的访问，显著加快数据读取速度。

### 2. 数据结构组合的典范
- 展示了如何将**哈希表**与**队列**结合，实现高效缓存。
- 通过指针链接两个结构，实现 O(1) 的查找与更新。

### 3. 系统设计启示

- 缓存是计算机系统中**层次化存储**思想的体现。
- 在算法设计中，也需考虑**数据局部性**与**访问成本**。

---

## 七、总结

- 缓存是**加速数据访问**的重要手段。
- LRU 缓存通过**哈希表 + 双向队列**实现高效查找与淘汰。
- 不同淘汰策略适用于不同场景，需根据实际数据模式选择。
- 缓存设计体现了**空间换时间**与**数据结构组合**的核心思想。

